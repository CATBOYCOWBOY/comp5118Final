{
  "timestamp": "2025-11-19T13:53:19.666602",
  "dataset_type": "spider2-lite",
  "experiments": {
    "config": {
      "name": "spider2_quick_test",
      "models": [
        "google/gemma-3-27b-it"
      ],
      "strategy": "spider2_basic",
      "max_examples": 3
    },
    "experiments": {
      "gemma-3-27b-it_spider2_basic": {
        "summary": {
          "total_examples": 3,
          "successful_executions": 0,
          "execution_accuracy": 0.0,
          "successful_examples": 0
        },
        "entries": [
          {
            "instance_id": "local002",
            "question": "Can you calculate the 5-day symmetric moving average of predicted toy sales for December 5 to 8, 2018, using daily sales data from January 1, 2017, to August 29, 2018, with a simple linear regression model? Finally provide the sum of those four 5-day moving averages?",
            "database": "E_commerce",
            "predicted_sql": "ite\nWITH DailySales AS (\n  SELECT\n    DATE(o.order_purchase_timestamp) AS sale_date,\n    SUM(oi.price) AS daily_sales\n  FROM orders AS o\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  JOIN products AS p\n    ON oi.product_id = p.product_id\n  JOIN product_category_name_translation AS pct\n    ON p.product_category_name = pct.product_category_name\n  WHERE\n    pct.product_category_name_english = 'Toys'\n    AND DATE(o.order_purchase_timestamp) BETWEEN '2017-01-01' AND '2018-08-29'\n  GROUP BY\n    DATE(o.order_purchase_timestamp)\n), LinearRegression AS (\n  SELECT\n    sale_date,\n    daily_sales,\n    JULIANDAY(sale_date) AS date_index\n  FROM DailySales\n), PredictedSales AS (\n  SELECT\n    sale_date,\n    -- Simple linear regression: y = mx + c\n    (\n      (\n        SELECT\n          (\n            SUM(\n              (\n                date_index - (\n                  SELECT\n                    AVG(date_index)\n                  FROM LinearRegression\n                )\n              ) * daily_sales\n            )\n          ) / SUM(\n            (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            ) * (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            )\n          )\n        FROM LinearRegression\n      ) * (\n        JULIANDAY('2018-12-05') - (\n          SELECT\n            AVG(date_index)\n          FROM LinearRegression\n        )\n      )\n    ) + (\n      (\n        SELECT\n          SUM(daily_sales) / COUNT(*)\n        FROM LinearRegression\n      )\n    ) AS predicted_sales\n  FROM LinearRegression\n  WHERE\n    sale_date BETWEEN '2017-01-01' AND '2018-08-29'\n  LIMIT 1\n), MovingAverages AS (\n  SELECT\n    DATE(sale_date) AS sale_date,\n    predicted_sales\n  FROM PredictedSales\n  WHERE\n    sale_date BETWEEN '2018-12-05' AND '2018-12-08'\n), FiveDaySMA AS (\n  SELECT\n    sale_date,\n    predicted_sales,\n    AVG(predicted_sales) OVER (\n      ORDER BY\n        sale_date ASC ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING\n    ) AS five_day_sma\n  FROM MovingAverages\n)\nSELECT\n  SUM(five_day_sma)\nFROM FiveDaySMA;",
            "extracted_sql": "ite\nWITH DailySales AS (\n  SELECT\n    DATE(o.order_purchase_timestamp) AS sale_date,\n    SUM(oi.price) AS daily_sales\n  FROM orders AS o\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  JOIN products AS p\n    ON oi.product_id = p.product_id\n  JOIN product_category_name_translation AS pct\n    ON p.product_category_name = pct.product_category_name\n  WHERE\n    pct.product_category_name_english = 'Toys'\n    AND DATE(o.order_purchase_timestamp) BETWEEN '2017-01-01' AND '2018-08-29'\n  GROUP BY\n    DATE(o.order_purchase_timestamp)\n), LinearRegression AS (\n  SELECT\n    sale_date,\n    daily_sales,\n    JULIANDAY(sale_date) AS date_index\n  FROM DailySales\n), PredictedSales AS (\n  SELECT\n    sale_date,\n    -- Simple linear regression: y = mx + c\n    (\n      (\n        SELECT\n          (\n            SUM(\n              (\n                date_index - (\n                  SELECT\n                    AVG(date_index)\n                  FROM LinearRegression\n                )\n              ) * daily_sales\n            )\n          ) / SUM(\n            (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            ) * (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            )\n          )\n        FROM LinearRegression\n      ) * (\n        JULIANDAY('2018-12-05') - (\n          SELECT\n            AVG(date_index)\n          FROM LinearRegression\n        )\n      )\n    ) + (\n      (\n        SELECT\n          SUM(daily_sales) / COUNT(*)\n        FROM LinearRegression\n      )\n    ) AS predicted_sales\n  FROM LinearRegression\n  WHERE\n    sale_date BETWEEN '2017-01-01' AND '2018-08-29'\n  LIMIT 1\n), MovingAverages AS (\n  SELECT\n    DATE(sale_date) AS sale_date,\n    predicted_sales\n  FROM PredictedSales\n  WHERE\n    sale_date BETWEEN '2018-12-05' AND '2018-12-08'\n), FiveDaySMA AS (\n  SELECT\n    sale_date,\n    predicted_sales,\n    AVG(predicted_sales) OVER (\n      ORDER BY\n        sale_date ASC ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING\n    ) AS five_day_sma\n  FROM MovingAverages\n)\nSELECT\n  SUM(five_day_sma)\nFROM FiveDaySMA;",
            "execution_success": false,
            "execution_match": false,
            "error": "Execution failed on sql 'ite\nWITH DailySales AS (\n  SELECT\n    DATE(o.order_purchase_timestamp) AS sale_date,\n    SUM(oi.price) AS daily_sales\n  FROM orders AS o\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  JOIN products AS p\n    ON oi.product_id = p.product_id\n  JOIN product_category_name_translation AS pct\n    ON p.product_category_name = pct.product_category_name\n  WHERE\n    pct.product_category_name_english = 'Toys'\n    AND DATE(o.order_purchase_timestamp) BETWEEN '2017-01-01' AND '2018-08-29'\n  GROUP BY\n    DATE(o.order_purchase_timestamp)\n), LinearRegression AS (\n  SELECT\n    sale_date,\n    daily_sales,\n    JULIANDAY(sale_date) AS date_index\n  FROM DailySales\n), PredictedSales AS (\n  SELECT\n    sale_date,\n    -- Simple linear regression: y = mx + c\n    (\n      (\n        SELECT\n          (\n            SUM(\n              (\n                date_index - (\n                  SELECT\n                    AVG(date_index)\n                  FROM LinearRegression\n                )\n              ) * daily_sales\n            )\n          ) / SUM(\n            (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            ) * (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            )\n          )\n        FROM LinearRegression\n      ) * (\n        JULIANDAY('2018-12-05') - (\n          SELECT\n            AVG(date_index)\n          FROM LinearRegression\n        )\n      )\n    ) + (\n      (\n        SELECT\n          SUM(daily_sales) / COUNT(*)\n        FROM LinearRegression\n      )\n    ) AS predicted_sales\n  FROM LinearRegression\n  WHERE\n    sale_date BETWEEN '2017-01-01' AND '2018-08-29'\n  LIMIT 1\n), MovingAverages AS (\n  SELECT\n    DATE(sale_date) AS sale_date,\n    predicted_sales\n  FROM PredictedSales\n  WHERE\n    sale_date BETWEEN '2018-12-05' AND '2018-12-08'\n), FiveDaySMA AS (\n  SELECT\n    sale_date,\n    predicted_sales,\n    AVG(predicted_sales) OVER (\n      ORDER BY\n        sale_date ASC ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING\n    ) AS five_day_sma\n  FROM MovingAverages\n)\nSELECT\n  SUM(five_day_sma)\nFROM FiveDaySMA;': near \"ite\": syntax error",
            "llm_response": "```sqlite\nWITH DailySales AS (\n  SELECT\n    DATE(o.order_purchase_timestamp) AS sale_date,\n    SUM(oi.price) AS daily_sales\n  FROM orders AS o\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  JOIN products AS p\n    ON oi.product_id = p.product_id\n  JOIN product_category_name_translation AS pct\n    ON p.product_category_name = pct.product_category_name\n  WHERE\n    pct.product_category_name_english = 'Toys'\n    AND DATE(o.order_purchase_timestamp) BETWEEN '2017-01-01' AND '2018-08-29'\n  GROUP BY\n    DATE(o.order_purchase_timestamp)\n), LinearRegression AS (\n  SELECT\n    sale_date,\n    daily_sales,\n    JULIANDAY(sale_date) AS date_index\n  FROM DailySales\n), PredictedSales AS (\n  SELECT\n    sale_date,\n    -- Simple linear regression: y = mx + c\n    (\n      (\n        SELECT\n          (\n            SUM(\n              (\n                date_index - (\n                  SELECT\n                    AVG(date_index)\n                  FROM LinearRegression\n                )\n              ) * daily_sales\n            )\n          ) / SUM(\n            (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            ) * (\n              date_index - (\n                SELECT\n                  AVG(date_index)\n                FROM LinearRegression\n              )\n            )\n          )\n        FROM LinearRegression\n      ) * (\n        JULIANDAY('2018-12-05') - (\n          SELECT\n            AVG(date_index)\n          FROM LinearRegression\n        )\n      )\n    ) + (\n      (\n        SELECT\n          SUM(daily_sales) / COUNT(*)\n        FROM LinearRegression\n      )\n    ) AS predicted_sales\n  FROM LinearRegression\n  WHERE\n    sale_date BETWEEN '2017-01-01' AND '2018-08-29'\n  LIMIT 1\n), MovingAverages AS (\n  SELECT\n    DATE(sale_date) AS sale_date,\n    predicted_sales\n  FROM PredictedSales\n  WHERE\n    sale_date BETWEEN '2018-12-05' AND '2018-12-08'\n), FiveDaySMA AS (\n  SELECT\n    sale_date,\n    predicted_sales,\n    AVG(predicted_sales) OVER (\n      ORDER BY\n        sale_date ASC ROWS BETWEEN 2 PRECEDING AND 2 FOLLOWING\n    ) AS five_day_sma\n  FROM MovingAverages\n)\nSELECT\n  SUM(five_day_sma)\nFROM FiveDaySMA;\n```",
            "performance": {
              "response_time": 31.87064242362976,
              "tokens_used": 273.0,
              "model": "google/gemma-3-27b-it"
            }
          },
          {
            "instance_id": "local003",
            "question": "According to the RFM definition document, calculate the average sales per order for each customer within distinct RFM segments, considering only 'delivered' orders. Use the customer unique identifier. Clearly define how to calculate Recency based on the latest purchase timestamp and specify the criteria for classifying RFM segments. The average sales should be computed as the total spend divided by the total number of orders. Please analyze and report the differences in average sales across the RFM segments",
            "database": "E_commerce",
            "predicted_sql": "ite\nWITH CustomerRFM AS (\n  SELECT\n    c.customer_unique_id,\n    MIN(JULIANDAY(o.order_delivered_customer_date) - JULIANDAY('2023-01-01')) AS Recency,\n    COUNT(o.order_id) AS Frequency,\n    SUM(oi.price + oi.freight_value) AS Monetary\n  FROM customers AS c\n  JOIN orders AS o\n    ON c.customer_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    c.customer_unique_id\n), RankedRFM AS (\n  SELECT\n    customer_unique_id,\n    NTILE(5) OVER (ORDER BY Recency DESC) AS R,\n    NTILE(5) OVER (ORDER BY Frequency) AS F,\n    NTILE(5) OVER (ORDER BY Monetary) AS M\n  FROM CustomerRFM\n), SegmentedRFM AS (\n  SELECT\n    customer_unique_id,\n    R,\n    F,\n    M,\n    CASE\n      WHEN R = 1 AND (F + M) BETWEEN 1 AND 4 THEN 'Champions'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 1 AND 2 THEN 'Can''t Lose Them'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 3 AND 6 THEN 'Hibernating'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 7 AND 10 THEN 'Lost'\n      WHEN R IN (2, 3) AND (F + M) BETWEEN 1 AND 4 THEN 'Loyal Customers'\n      WHEN R = 3 AND (F + M) BETWEEN 5 AND 6 THEN 'Needs Attention'\n      WHEN R = 1 AND (F + M) BETWEEN 7 AND 8 THEN 'Recent Users'\n      WHEN (R = 1 AND (F + M) BETWEEN 5 AND 6) OR (R = 2 AND (F + M) BETWEEN 5 AND 8) THEN 'Potential Loyalists'\n      WHEN R = 1 AND (F + M) BETWEEN 9 AND 10 THEN 'Price Sensitive'\n      WHEN R = 2 AND (F + M) BETWEEN 9 AND 10 THEN 'Promising'\n      WHEN R = 3 AND (F + M) BETWEEN 7 AND 10 THEN 'About to Sleep'\n      ELSE 'Other'\n    END AS RFM_Segment\n  FROM RankedRFM\n)\nSELECT\n  RFM_Segment,\n  AVG(Total_Spend / Total_Orders) AS Average_Sales_Per_Order\nFROM (\n  SELECT\n    s.RFM_Segment,\n    SUM(oi.price + oi.freight_value) AS Total_Spend,\n    COUNT(o.order_id) AS Total_Orders\n  FROM SegmentedRFM AS s\n  JOIN orders AS o\n    ON s.customer_unique_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    s.RFM_Segment\n)\nGROUP BY\n  RFM_Segment;",
            "extracted_sql": "ite\nWITH CustomerRFM AS (\n  SELECT\n    c.customer_unique_id,\n    MIN(JULIANDAY(o.order_delivered_customer_date) - JULIANDAY('2023-01-01')) AS Recency,\n    COUNT(o.order_id) AS Frequency,\n    SUM(oi.price + oi.freight_value) AS Monetary\n  FROM customers AS c\n  JOIN orders AS o\n    ON c.customer_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    c.customer_unique_id\n), RankedRFM AS (\n  SELECT\n    customer_unique_id,\n    NTILE(5) OVER (ORDER BY Recency DESC) AS R,\n    NTILE(5) OVER (ORDER BY Frequency) AS F,\n    NTILE(5) OVER (ORDER BY Monetary) AS M\n  FROM CustomerRFM\n), SegmentedRFM AS (\n  SELECT\n    customer_unique_id,\n    R,\n    F,\n    M,\n    CASE\n      WHEN R = 1 AND (F + M) BETWEEN 1 AND 4 THEN 'Champions'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 1 AND 2 THEN 'Can''t Lose Them'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 3 AND 6 THEN 'Hibernating'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 7 AND 10 THEN 'Lost'\n      WHEN R IN (2, 3) AND (F + M) BETWEEN 1 AND 4 THEN 'Loyal Customers'\n      WHEN R = 3 AND (F + M) BETWEEN 5 AND 6 THEN 'Needs Attention'\n      WHEN R = 1 AND (F + M) BETWEEN 7 AND 8 THEN 'Recent Users'\n      WHEN (R = 1 AND (F + M) BETWEEN 5 AND 6) OR (R = 2 AND (F + M) BETWEEN 5 AND 8) THEN 'Potential Loyalists'\n      WHEN R = 1 AND (F + M) BETWEEN 9 AND 10 THEN 'Price Sensitive'\n      WHEN R = 2 AND (F + M) BETWEEN 9 AND 10 THEN 'Promising'\n      WHEN R = 3 AND (F + M) BETWEEN 7 AND 10 THEN 'About to Sleep'\n      ELSE 'Other'\n    END AS RFM_Segment\n  FROM RankedRFM\n)\nSELECT\n  RFM_Segment,\n  AVG(Total_Spend / Total_Orders) AS Average_Sales_Per_Order\nFROM (\n  SELECT\n    s.RFM_Segment,\n    SUM(oi.price + oi.freight_value) AS Total_Spend,\n    COUNT(o.order_id) AS Total_Orders\n  FROM SegmentedRFM AS s\n  JOIN orders AS o\n    ON s.customer_unique_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    s.RFM_Segment\n)\nGROUP BY\n  RFM_Segment;",
            "execution_success": false,
            "execution_match": false,
            "error": "Execution failed on sql 'ite\nWITH CustomerRFM AS (\n  SELECT\n    c.customer_unique_id,\n    MIN(JULIANDAY(o.order_delivered_customer_date) - JULIANDAY('2023-01-01')) AS Recency,\n    COUNT(o.order_id) AS Frequency,\n    SUM(oi.price + oi.freight_value) AS Monetary\n  FROM customers AS c\n  JOIN orders AS o\n    ON c.customer_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    c.customer_unique_id\n), RankedRFM AS (\n  SELECT\n    customer_unique_id,\n    NTILE(5) OVER (ORDER BY Recency DESC) AS R,\n    NTILE(5) OVER (ORDER BY Frequency) AS F,\n    NTILE(5) OVER (ORDER BY Monetary) AS M\n  FROM CustomerRFM\n), SegmentedRFM AS (\n  SELECT\n    customer_unique_id,\n    R,\n    F,\n    M,\n    CASE\n      WHEN R = 1 AND (F + M) BETWEEN 1 AND 4 THEN 'Champions'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 1 AND 2 THEN 'Can''t Lose Them'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 3 AND 6 THEN 'Hibernating'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 7 AND 10 THEN 'Lost'\n      WHEN R IN (2, 3) AND (F + M) BETWEEN 1 AND 4 THEN 'Loyal Customers'\n      WHEN R = 3 AND (F + M) BETWEEN 5 AND 6 THEN 'Needs Attention'\n      WHEN R = 1 AND (F + M) BETWEEN 7 AND 8 THEN 'Recent Users'\n      WHEN (R = 1 AND (F + M) BETWEEN 5 AND 6) OR (R = 2 AND (F + M) BETWEEN 5 AND 8) THEN 'Potential Loyalists'\n      WHEN R = 1 AND (F + M) BETWEEN 9 AND 10 THEN 'Price Sensitive'\n      WHEN R = 2 AND (F + M) BETWEEN 9 AND 10 THEN 'Promising'\n      WHEN R = 3 AND (F + M) BETWEEN 7 AND 10 THEN 'About to Sleep'\n      ELSE 'Other'\n    END AS RFM_Segment\n  FROM RankedRFM\n)\nSELECT\n  RFM_Segment,\n  AVG(Total_Spend / Total_Orders) AS Average_Sales_Per_Order\nFROM (\n  SELECT\n    s.RFM_Segment,\n    SUM(oi.price + oi.freight_value) AS Total_Spend,\n    COUNT(o.order_id) AS Total_Orders\n  FROM SegmentedRFM AS s\n  JOIN orders AS o\n    ON s.customer_unique_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    s.RFM_Segment\n)\nGROUP BY\n  RFM_Segment;': near \"ite\": syntax error",
            "llm_response": "```sqlite\nWITH CustomerRFM AS (\n  SELECT\n    c.customer_unique_id,\n    MIN(JULIANDAY(o.order_delivered_customer_date) - JULIANDAY('2023-01-01')) AS Recency,\n    COUNT(o.order_id) AS Frequency,\n    SUM(oi.price + oi.freight_value) AS Monetary\n  FROM customers AS c\n  JOIN orders AS o\n    ON c.customer_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    c.customer_unique_id\n), RankedRFM AS (\n  SELECT\n    customer_unique_id,\n    NTILE(5) OVER (ORDER BY Recency DESC) AS R,\n    NTILE(5) OVER (ORDER BY Frequency) AS F,\n    NTILE(5) OVER (ORDER BY Monetary) AS M\n  FROM CustomerRFM\n), SegmentedRFM AS (\n  SELECT\n    customer_unique_id,\n    R,\n    F,\n    M,\n    CASE\n      WHEN R = 1 AND (F + M) BETWEEN 1 AND 4 THEN 'Champions'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 1 AND 2 THEN 'Can''t Lose Them'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 3 AND 6 THEN 'Hibernating'\n      WHEN R IN (4, 5) AND (F + M) BETWEEN 7 AND 10 THEN 'Lost'\n      WHEN R IN (2, 3) AND (F + M) BETWEEN 1 AND 4 THEN 'Loyal Customers'\n      WHEN R = 3 AND (F + M) BETWEEN 5 AND 6 THEN 'Needs Attention'\n      WHEN R = 1 AND (F + M) BETWEEN 7 AND 8 THEN 'Recent Users'\n      WHEN (R = 1 AND (F + M) BETWEEN 5 AND 6) OR (R = 2 AND (F + M) BETWEEN 5 AND 8) THEN 'Potential Loyalists'\n      WHEN R = 1 AND (F + M) BETWEEN 9 AND 10 THEN 'Price Sensitive'\n      WHEN R = 2 AND (F + M) BETWEEN 9 AND 10 THEN 'Promising'\n      WHEN R = 3 AND (F + M) BETWEEN 7 AND 10 THEN 'About to Sleep'\n      ELSE 'Other'\n    END AS RFM_Segment\n  FROM RankedRFM\n)\nSELECT\n  RFM_Segment,\n  AVG(Total_Spend / Total_Orders) AS Average_Sales_Per_Order\nFROM (\n  SELECT\n    s.RFM_Segment,\n    SUM(oi.price + oi.freight_value) AS Total_Spend,\n    COUNT(o.order_id) AS Total_Orders\n  FROM SegmentedRFM AS s\n  JOIN orders AS o\n    ON s.customer_unique_id = o.customer_id\n  JOIN order_items AS oi\n    ON o.order_id = oi.order_id\n  WHERE\n    o.order_status = 'delivered'\n  GROUP BY\n    s.RFM_Segment\n)\nGROUP BY\n  RFM_Segment;\n```",
            "performance": {
              "response_time": 26.804868459701538,
              "tokens_used": 422.5,
              "model": "google/gemma-3-27b-it"
            }
          },
          {
            "instance_id": "local004",
            "question": "Could you tell me the number of orders, average payment per order and customer lifespan in weeks of the 3 custumers with the highest average payment per order, where the lifespan is calculated by subtracting the earliest purchase date from the latest purchase date in days, dividing by seven, and if the result is less than seven days, setting it to 1.0?",
            "database": "E_commerce",
            "predicted_sql": "ite\nSELECT\n  COUNT(T1.order_id),\n  AVG(T2.payment_value),\n  AVG(\n    CASE\n      WHEN STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp)) < 7\n      THEN 1.0\n      ELSE (\n        STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp))\n      ) / 7.0\n    END\n  )\nFROM orders AS T1\nINNER JOIN order_payments AS T2\n  ON T1.order_id = T2.order_id\nWHERE\n  T1.customer_id IN (\n    SELECT\n      customer_id\n    FROM orders AS T3\n    INNER JOIN order_payments AS T4\n      ON T3.order_id = T4.order_id\n    GROUP BY\n      customer_id\n    ORDER BY\n      AVG(T4.payment_value) DESC\n    LIMIT 3\n  )\nGROUP BY\n  T1.customer_id;",
            "extracted_sql": "ite\nSELECT\n  COUNT(T1.order_id),\n  AVG(T2.payment_value),\n  AVG(\n    CASE\n      WHEN STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp)) < 7\n      THEN 1.0\n      ELSE (\n        STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp))\n      ) / 7.0\n    END\n  )\nFROM orders AS T1\nINNER JOIN order_payments AS T2\n  ON T1.order_id = T2.order_id\nWHERE\n  T1.customer_id IN (\n    SELECT\n      customer_id\n    FROM orders AS T3\n    INNER JOIN order_payments AS T4\n      ON T3.order_id = T4.order_id\n    GROUP BY\n      customer_id\n    ORDER BY\n      AVG(T4.payment_value) DESC\n    LIMIT 3\n  )\nGROUP BY\n  T1.customer_id;",
            "execution_success": false,
            "execution_match": false,
            "error": "Execution failed on sql 'ite\nSELECT\n  COUNT(T1.order_id),\n  AVG(T2.payment_value),\n  AVG(\n    CASE\n      WHEN STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp)) < 7\n      THEN 1.0\n      ELSE (\n        STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp))\n      ) / 7.0\n    END\n  )\nFROM orders AS T1\nINNER JOIN order_payments AS T2\n  ON T1.order_id = T2.order_id\nWHERE\n  T1.customer_id IN (\n    SELECT\n      customer_id\n    FROM orders AS T3\n    INNER JOIN order_payments AS T4\n      ON T3.order_id = T4.order_id\n    GROUP BY\n      customer_id\n    ORDER BY\n      AVG(T4.payment_value) DESC\n    LIMIT 3\n  )\nGROUP BY\n  T1.customer_id;': near \"ite\": syntax error",
            "llm_response": "```sqlite\nSELECT\n  COUNT(T1.order_id),\n  AVG(T2.payment_value),\n  AVG(\n    CASE\n      WHEN STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp)) < 7\n      THEN 1.0\n      ELSE (\n        STRFTIME('%J', MAX(T1.order_purchase_timestamp)) - STRFTIME('%J', MIN(T1.order_purchase_timestamp))\n      ) / 7.0\n    END\n  )\nFROM orders AS T1\nINNER JOIN order_payments AS T2\n  ON T1.order_id = T2.order_id\nWHERE\n  T1.customer_id IN (\n    SELECT\n      customer_id\n    FROM orders AS T3\n    INNER JOIN order_payments AS T4\n      ON T3.order_id = T4.order_id\n    GROUP BY\n      customer_id\n    ORDER BY\n      AVG(T4.payment_value) DESC\n    LIMIT 3\n  )\nGROUP BY\n  T1.customer_id;\n```",
            "performance": {
              "response_time": 8.699062824249268,
              "tokens_used": 96.2,
              "model": "google/gemma-3-27b-it"
            }
          }
        ]
      }
    }
  }
}